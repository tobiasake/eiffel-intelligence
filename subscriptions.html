<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 2019-12-02 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20191202" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Eiffel Intelligence &#x2013; Subscriptions</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

          
                      </head>
        <body class="topBarEnabled">
          
                
                    
                

    <div id="topbar" class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
                <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
                
                                                                                                    <a class="brand" href="./" >

                                
                                    Eiffel Intelligence
                
                </a>
                    
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="index.html"  title="Home">Home</a>
</li>
                  
                      <li class="dropdown-submenu">
                                      <a href="running-eiffel-intelligence.html"  title="Running Eiffel Intelligence">Running Eiffel Intelligence</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="configuration.html"  title="Configuration">Configuration</a>
</li>
                                  <li>      <a href="docker.html"  title="Running in Docker">Running in Docker</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="subscriptions.html"  title="Understanding subscriptions">Understanding subscriptions</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="subscription-with-REST-POST-notification.html"  title="Subscription with REST POST notification">Subscription with REST POST notification</a>
</li>
                                  <li>      <a href="triggering-jenkins-jobs.html"  title="HTTP POST notification to trigger parameterized Jenkins jobs">HTTP POST notification to trigger parameterized Jenkins jobs</a>
</li>
                                  <li>      <a href="subscription-with-email-notification.html"  title="Subscription with Email notification">Subscription with Email notification</a>
</li>
                                  <li>      <a href="step-by-step-subscription-notification.html"  title="Step-by-step Subscription Notification">Step-by-step Subscription Notification</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="rules.html"  title="Understanding rules">Understanding rules</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="merge-resolver-rules.html"  title="Merge Resolver Rules">Merge Resolver Rules</a>
</li>
                                  <li>      <a href="history-rules.html"  title="History Rules">History Rules</a>
</li>
                                  <li>      <a href="example-rules.html"  title="Example Rules">Example Rules</a>
</li>
                                  <li>      <a href="mapping-rules-to-aggregations.html"  title="Mapping Rules To Aggregations">Mapping Rules To Aggregations</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="step-by-step-aggregation.html"  title="Step-by-step aggregation">Step-by-step aggregation</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="artifact-created-event-aggregation.html"  title="ArtifactCreatedEvent aggregation">ArtifactCreatedEvent aggregation</a>
</li>
                                  <li>      <a href="test-case-triggered-event-aggregation.html"  title="TestCaseTriggeredEvent aggregation">TestCaseTriggeredEvent aggregation</a>
</li>
                                  <li>      <a href="test-case-started-event-aggregation.html"  title="TestCaseStartedEvent aggregation">TestCaseStartedEvent aggregation</a>
</li>
                                  <li>      <a href="test-case-finished-event-aggregation.html"  title="TestCaseFinishedEvent aggregation">TestCaseFinishedEvent aggregation</a>
</li>
                                  <li>      <a href="artifact-published-event-aggregation.html"  title="ArtifactPublishedEvent aggregation">ArtifactPublishedEvent aggregation</a>
</li>
                                  <li>      <a href="confidence-level-modified-event-aggregation.html"  title="ConfidenceLevelModifiedEvent">ConfidenceLevelModifiedEvent</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="REST-API.html"  title="REST API">REST API</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="query.html"  title="Query">Query</a>
</li>
                                  <li>      <a href="failed-notifications.html"  title="Failed notifications">Failed notifications</a>
</li>
                                  <li>      <a href="running-rules-on-objects.html"  title="Running rules on objects">Running rules on objects</a>
</li>
                                  <li>      <a href="authentication.html"  title="Authentication">Authentication</a>
</li>
                                  <li>      <a href="subscription-API.html"  title="Subscriptions">Subscriptions</a>
</li>
                                  <li>      <a href="status.html"  title="Status">Status</a>
</li>
                                  <li>      <a href="templates.html"  title="Get templates">Get templates</a>
</li>
                              </ul>
            </li>
                  
                      <li>      <a href="compatibility.html"  title="Compatibility">Compatibility</a>
</li>
                  
                      <li>      <a href="known-limitations.html"  title="Known limitations">Known limitations</a>
</li>
                          </ul>
      </li>
                  </ul>
          
          
          
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Eiffel Intelligence</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                              <li class="">
                    <a href="index.html" title="Home">
        Home</a>
                    <span class="divider">-</span>
      </li>
        <li class="active ">Subscriptions</li>
        
              
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2019-12-02</li>
              <li id="projectVersion" class="pull-right">
                    Version: 2.0.0
        </li>
            
                            </ul>
      </div>

                  
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                              
      <li>
  
                          <a href="index.html" title="Home">
          <span class="none"></span>
        Home</a>
            </li>
                                                                                    
      <li>
  
                          <a href="running-eiffel-intelligence.html" title="Running Eiffel Intelligence">
          <span class="icon-chevron-right"></span>
        Running Eiffel Intelligence</a>
                  </li>
                                                                                                                            
      <li class="active">
  
            <a href="#"><span class="icon-chevron-down"></span>Understanding subscriptions</a>
                  <ul class="nav nav-list">
                    
      <li>
  
                          <a href="subscription-with-REST-POST-notification.html" title="Subscription with REST POST notification">
          <span class="none"></span>
        Subscription with REST POST notification</a>
            </li>
                    
      <li>
  
                          <a href="triggering-jenkins-jobs.html" title="HTTP POST notification to trigger parameterized Jenkins jobs">
          <span class="none"></span>
        HTTP POST notification to trigger parameterized Jenkins jobs</a>
            </li>
                    
      <li>
  
                          <a href="subscription-with-email-notification.html" title="Subscription with Email notification">
          <span class="none"></span>
        Subscription with Email notification</a>
            </li>
                    
      <li>
  
                          <a href="step-by-step-subscription-notification.html" title="Step-by-step Subscription Notification">
          <span class="none"></span>
        Step-by-step Subscription Notification</a>
            </li>
              </ul>
        </li>
                                                                                                                        
      <li>
  
                          <a href="rules.html" title="Understanding rules">
          <span class="icon-chevron-right"></span>
        Understanding rules</a>
                  </li>
                                                                                                                                                            
      <li>
  
                          <a href="step-by-step-aggregation.html" title="Step-by-step aggregation">
          <span class="icon-chevron-right"></span>
        Step-by-step aggregation</a>
                  </li>
                                                                                                                                                                              
      <li>
  
                          <a href="REST-API.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                
      <li>
  
                          <a href="compatibility.html" title="Compatibility">
          <span class="none"></span>
        Compatibility</a>
            </li>
                
      <li>
  
                          <a href="known-limitations.html" title="Known limitations">
          <span class="none"></span>
        Known limitations</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                        
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Subscriptions</h1>
<p>When the desired Eiffel events have been aggregated a user would like to be notified. It is possible to create a subscription which Eiffel Intelligence will match against the saved aggregations.</p>
<p>Whenever an aggregated object is created or modified, it is evaluated against all existing subscriptions to find out whether the aggregated object meets any subscription requirements. If it fulfills a subscription requirement then a notification is sent to the subscriber as specified in that subscription. For further explanation of the process, <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/step-by-step-subscription-notification.md">consider the following example</a>.</p>
<div class="section">
<div class="section">
<h3><a name="Adding_subscriptions"></a>Adding subscriptions</h3>
<p>It is possible to add subscriptions using the <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence-frontend/blob/master/wiki/markdown/add-subscription.md">Eiffel Intelligence front-end GUI</a>. It is also possible to manage subscriptions <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/subscription-API.md">using the REST API</a>.</p></div>
<div class="section">
<h3><a name="Types_of_notifications_for_subscriptions"></a>Types of notifications for subscriptions</h3>
<p>Today Eiffel Intelligence supports notifications by email or by sending a HTTP POST request. Example subscriptions in JSON format with different types of notification can be found in the below links:</p>
<ul>

<li><a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/subscription-with-REST-POST-notification.md">Subscription with HTTP POST notification</a></li>
<li><a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/triggering-jenkins-jobs.md">Subscription with HTTP POST notification to trigger parameterized Jenkins job</a></li>
<li><a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/subscription-with-email-notification.md">Subscription with E-mail notification</a></li>
</ul>
<p>The different fields in a subscription are also described in the <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence-frontend/blob/master/wiki/markdown/add-subscription.md">front-end documentation</a>.</p></div>
<div class="section">
<h3><a name="Writing_requirements_and_conditions"></a>Writing requirements and conditions</h3>
<p>When writing subscription requirements, they are referencing the structure of the aggregated object, which Eiffel Intelligence will create, based on the rules it was configured with. It is therefore important to know what the aggregated object will look like when writing the conditions. The requirements inside a subscription should reflect a wanted state of the aggregation, for example: &#x201c;<i>Hey Eiffel Intelligence, let me know when my artifact has been published here!</i>&#x201d; or &#x201c;<i>I want to know when these two products have reached confidence level X</i>&#x201d;.</p>
<p>We will go through how to write some example requirements in a subscription based on the below aggregated object. What you see in the aggregation is the extracted content from Eiffel events. Aside from that Eiffel Intelligence has also added an extra _id key with the value of the start event. This _id serves as an index in Mongo DB to speed up searches in the database. The below aggregation is based on the <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/src/main/resources/rules/ArtifactRules-Eiffel-Agen-Version.json">Artifact rules</a>.</p>
<p><b>Aggregation from several Eiffel events:</b></p>

<div>
<div>
<pre class="source">{
        &quot;_id&quot; : &quot;df4cdb42-1580-4cff-b97a-4d0faa9b2b22&quot;,
        &quot;fileInformation&quot; : [
            {
                &quot;extension&quot; : &quot;war&quot;,
                &quot;classifier&quot; : &quot;&quot;
            }
        ],
        &quot;artifactCustomData&quot; : [],
        &quot;buildCommand&quot; : &quot;trigger&quot;,
        &quot;identity&quot; : &quot;pkg:maven/com.mycompany.myproduct/artifact-name@2.1.7&quot;,
        &quot;confidenceLevels&quot; : [
            {
                &quot;eventId&quot; : &quot;e3be0cf8-2ebd-4d6d-bf5c-a3b535cd084e&quot;,
                &quot;name&quot; : &quot;dummy_1_stable&quot;,
                &quot;time&quot; : 1521452400324,
                &quot;value&quot; : &quot;SUCCESS&quot;
            }
        ],
        &quot;TemplateName&quot; : &quot;ARTIFACT_1&quot;,
        &quot;id&quot; : &quot;df4cdb42-1580-4cff-b97a-4d0faa9b2b22&quot;,
        &quot;time&quot; : 1521452368194,
        &quot;type&quot; : &quot;EiffelArtifactCreatedEvent&quot;,
        &quot;publications&quot; : [
            {
                &quot;eventId&quot; : &quot;2acd348d-05e6-4945-b441-dc7c1e55534e&quot;,
                &quot;locations&quot; : [
                    {
                        &quot;type&quot; : &quot;NEXUS&quot;,
                        &quot;uri&quot; : &quot;http://host:port/path&quot;
                    }
                ],
                &quot;time&quot; : 1521452368758
            }
        ]
}
</pre></div></div>

<p>In order for a subscription to be triggered, the subscription requirement needs to be fulfilled. The requirements can be grouped with one or several conditions inside them. Each requirement group is separated with an &#x2018;OR&#x2019;, while the conditions inside a requirement are connected with an &#x2018;AND&#x2019;. This means all the conditions in a requirement group must be fulfilled, while only one of the requirement groups needs to be fulfilled, for the subscription to trigger.</p>
<p>Let&#x2019;s say we need a subscription which is triggered on when an artifact has been published to a location of type &#x201c;NEXUS&#x201d;. This subscription wants to listen for when an Eiffel ArtifactPublished event is aggregated by Eiffel Intelligence.</p>
<p>Conditions in subscriptions are written in <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/rules.md#What-is-JMESPath?">JMESPath syntax</a>. The JSON structure of the subscription condition always contains a key &#x201c;jmespath&#x201d; and the value is a JMESPath expression. In the example below, we want to know when Eiffel Intelligence has aggregated information about an artifact being published in Nexus. A subscription with only this condition will be fulfilled as soon as Eiffel Intelligence aggregates data from an ArtifactPublished event with the correct data.</p>

<div>
<div>
<pre class="source">&quot;requirements&quot; : [
    {
        &quot;conditions&quot; : [
            {
                &quot;jmespath&quot;: &quot;publications[?locations[?type=='NEXUS']]&quot;
            }
        ]
    }
]
</pre></div></div>

<p>If we instead want to trigger a subscription based on when an artifact has reached the confidence level of &#x2018;SUCCESS&#x2019; we can write the below expression for our condition:</p>

<div>
<div>
<pre class="source">{
    &quot;jmespath&quot;: &quot;confidenceLevels[?name=='dummy_1_stable'] &amp;&amp; confidenceLevels[?value=='SUCCESS']&quot;
}
</pre></div></div>

<p>the exact same condition can also be written like below:</p>

<div>
<div>
<pre class="source">{
    &quot;jmespath&quot;: &quot;confidenceLevels[?name=='dummy_1_stable' &amp;&amp; value=='SUCCESS']&quot;
}
</pre></div></div>

<p>If you want to include both of these conditions in the same subscription, (i.e. you want to know when the aggregation contains information about both published artifact locations AND have reached the specified confidence level) the subscription will look like the below json structure:</p>

<div>
<div>
<pre class="source">&quot;requirements&quot; : [
    {
        &quot;conditions&quot; : [
            {
                &quot;jmespath&quot;: &quot;publications[?locations[?type=='NEXUS']]&quot;
            },
            {
                &quot;jmespath&quot;: &quot;confidenceLevels[?name=='dummy_1_stable' &amp;&amp; value=='SUCCESS']&quot;
            }
        ]
    }
]
</pre></div></div>

<p>This subscription now contains the requirement with two conditions: 1) the artifact name is the right one AND 2) the confidence level is what we are looking for. If we instead would like the subscription to check for the first condition OR the second one, the syntax would look like below:</p>

<div>
<div>
<pre class="source">&quot;requirements&quot;: [
    {
        &quot;conditions&quot;: [
            {
                &quot;jmespath&quot;: &quot;publications[?locations[?type=='NEXUS']]&quot;
            }
        ]
    },
    {
        &quot;conditions&quot;: [
            {
                &quot;jmespath&quot;: &quot;confidenceLevels[?name=='dummy_1_stable' &amp;&amp; value=='SUCCESS']&quot;
            }
        ]
    }
]
</pre></div></div>

<p>This subscription describes two requirements and as soon as one of them has been fulfilled, Eiffel Intelligence would perform a notification. More subscription templates <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/tree/master/src/main/resources/templates">can be found here</a>.</p></div>
<div class="section">
<h3><a name="Repeat_handling"></a>Repeat handling</h3>
<p>See in the front-end documentation <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence-frontend/blob/master/wiki/markdown/add-subscription.md">here</a></p></div>
<div class="section">
<h3><a name="Adding_comments_inside_subscription"></a>Adding comments inside subscription</h3>
<p>It is possible for users to add comments, at any level, in subscriptions. These comments should be a new field in the given subscription, following the json format. They will not be seen in the front-end GUI but only in the JSON structure if downloaded from Eiffel Intelligence.</p>

<div>
<div>
<pre class="source">{
    &quot;description&quot;: &quot;It is my comment&quot;
}
</pre></div></div>
</div>
<div class="section">
<h3><a name="Using_JMESPath_in_subscriptions"></a>Using JMESPath in subscriptions</h3>
<p>Eiffel Intelligence supports several pre-defined methods in the JMESPath expressions inside a subscription. For example it is possible to include the entire aggregation (or parts of it) in the notification Eiffel Intelligence sends when a subscription is fulfilled.</p>
<p>If Eiffel Intelligence should send a HTTP POST request somewhere with the complete aggregation it could look like this:</p>

<div>
<div>
<pre class="source">&quot;restPostBodyMediaType&quot;: &quot;application/json&quot;,
&quot;notificationMeta&quot;: &quot;some-external-api/endpoint&quot;
&quot;notificationMessageKeyValues&quot;: [
    {
        &quot;formkey&quot;: &quot;external-api-parameter-name&quot;,
        &quot;formvalue&quot;: &quot;@&quot;
    }
],
</pre></div></div>

<p>The form key should match the external API to which Eiffel Intelligence will send the notification of a fulfilled subscription. The form value will be run through JMESPath engine so it is possible to use JMESPath expressions to extract content from the aggregated object. The form value can only be one JSON object. In the above example the full aggregation can be sent using the &#x2018;@&#x2019; character. To access parts of the aggregation it is possible to define like the below examples:</p>

<div>
<div>
<pre class="source">@.identity         // represents the identity string from the aggregation
@.some_array       // it is possible to extract an array from the aggregation
</pre></div></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                          
                </div>

        
                </div>
    </footer>
        </body>
</html>
