<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 2019-12-02 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20191202" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Eiffel Intelligence &#x2013; Query Aggregated Objects</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

          
                      </head>
        <body class="topBarEnabled">
          
                
                    
                

    <div id="topbar" class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
                <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
                
                                                                                                    <a class="brand" href="./" >

                                
                                    Eiffel Intelligence
                
                </a>
                    
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="index.html"  title="Home">Home</a>
</li>
                  
                      <li class="dropdown-submenu">
                                      <a href="running-eiffel-intelligence.html"  title="Running Eiffel Intelligence">Running Eiffel Intelligence</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="configuration.html"  title="Configuration">Configuration</a>
</li>
                                  <li>      <a href="docker.html"  title="Running in Docker">Running in Docker</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="subscriptions.html"  title="Understanding subscriptions">Understanding subscriptions</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="subscription-with-REST-POST-notification.html"  title="Subscription with REST POST notification">Subscription with REST POST notification</a>
</li>
                                  <li>      <a href="triggering-jenkins-jobs.html"  title="HTTP POST notification to trigger parameterized Jenkins jobs">HTTP POST notification to trigger parameterized Jenkins jobs</a>
</li>
                                  <li>      <a href="subscription-with-email-notification.html"  title="Subscription with Email notification">Subscription with Email notification</a>
</li>
                                  <li>      <a href="step-by-step-subscription-notification.html"  title="Step-by-step Subscription Notification">Step-by-step Subscription Notification</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="rules.html"  title="Understanding rules">Understanding rules</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="merge-resolver-rules.html"  title="Merge Resolver Rules">Merge Resolver Rules</a>
</li>
                                  <li>      <a href="history-rules.html"  title="History Rules">History Rules</a>
</li>
                                  <li>      <a href="example-rules.html"  title="Example Rules">Example Rules</a>
</li>
                                  <li>      <a href="mapping-rules-to-aggregations.html"  title="Mapping Rules To Aggregations">Mapping Rules To Aggregations</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="step-by-step-aggregation.html"  title="Step-by-step aggregation">Step-by-step aggregation</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="artifact-created-event-aggregation.html"  title="ArtifactCreatedEvent aggregation">ArtifactCreatedEvent aggregation</a>
</li>
                                  <li>      <a href="test-case-triggered-event-aggregation.html"  title="TestCaseTriggeredEvent aggregation">TestCaseTriggeredEvent aggregation</a>
</li>
                                  <li>      <a href="test-case-started-event-aggregation.html"  title="TestCaseStartedEvent aggregation">TestCaseStartedEvent aggregation</a>
</li>
                                  <li>      <a href="test-case-finished-event-aggregation.html"  title="TestCaseFinishedEvent aggregation">TestCaseFinishedEvent aggregation</a>
</li>
                                  <li>      <a href="artifact-published-event-aggregation.html"  title="ArtifactPublishedEvent aggregation">ArtifactPublishedEvent aggregation</a>
</li>
                                  <li>      <a href="confidence-level-modified-event-aggregation.html"  title="ConfidenceLevelModifiedEvent">ConfidenceLevelModifiedEvent</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="REST-API.html"  title="REST API">REST API</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="query.html"  title="Query">Query</a>
</li>
                                  <li>      <a href="failed-notifications.html"  title="Failed notifications">Failed notifications</a>
</li>
                                  <li>      <a href="running-rules-on-objects.html"  title="Running rules on objects">Running rules on objects</a>
</li>
                                  <li>      <a href="authentication.html"  title="Authentication">Authentication</a>
</li>
                                  <li>      <a href="subscription-API.html"  title="Subscriptions">Subscriptions</a>
</li>
                                  <li>      <a href="status.html"  title="Status">Status</a>
</li>
                                  <li>      <a href="templates.html"  title="Get templates">Get templates</a>
</li>
                              </ul>
            </li>
                  
                      <li>      <a href="compatibility.html"  title="Compatibility">Compatibility</a>
</li>
                  
                      <li>      <a href="known-limitations.html"  title="Known limitations">Known limitations</a>
</li>
                          </ul>
      </li>
                  </ul>
          
          
          
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Eiffel Intelligence</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                              <li class="">
                    <a href="index.html" title="Home">
        Home</a>
                    <span class="divider">-</span>
      </li>
        <li class="active ">Query Aggregated Objects</li>
        
              
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2019-12-02</li>
              <li id="projectVersion" class="pull-right">
                    Version: 2.0.0
        </li>
            
                            </ul>
      </div>

                  
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                              
      <li>
  
                          <a href="index.html" title="Home">
          <span class="none"></span>
        Home</a>
            </li>
                                                                                    
      <li>
  
                          <a href="running-eiffel-intelligence.html" title="Running Eiffel Intelligence">
          <span class="icon-chevron-right"></span>
        Running Eiffel Intelligence</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="subscriptions.html" title="Understanding subscriptions">
          <span class="icon-chevron-right"></span>
        Understanding subscriptions</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="rules.html" title="Understanding rules">
          <span class="icon-chevron-right"></span>
        Understanding rules</a>
                  </li>
                                                                                                                                                            
      <li>
  
                          <a href="step-by-step-aggregation.html" title="Step-by-step aggregation">
          <span class="icon-chevron-right"></span>
        Step-by-step aggregation</a>
                  </li>
                                                                                                                                                                              
      <li>
  
                          <a href="REST-API.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                
      <li>
  
                          <a href="compatibility.html" title="Compatibility">
          <span class="none"></span>
        Compatibility</a>
            </li>
                
      <li>
  
                          <a href="known-limitations.html" title="Known limitations">
          <span class="none"></span>
        Known limitations</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                        
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Query Aggregated Objects</h1>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>Method</th>
<th>Endpoint             </th></tr>
</thead><tbody>

<tr class="b">
<td>GET   </td>
<td>/aggregated-objects</td></tr>
<tr class="a">
<td>POST  </td>
<td>/aggregated-objects/query</td></tr>
</tbody>
</table>
<p>Query on aggregated objects can be performed using the above mentioned endpoint. There are two possibilities to query aggregated objects.</p>
<div class="section">
<h2><a name="Perform_query_on_created_aggregated_object_using_event_id"></a>Perform query on created aggregated object using event id</h2>

<div>
<div>
<pre class="source">GET /aggregated-objects
</pre></div></div>

<p><b>URI parameters</b>: {documentID}</p>
<p>Query through this option is more strict and the user must provide the id of the event that started the aggregated object.</p>
<p>Examples of this endpoint using curl with an a given id = 6acc3c87-75e0-4b6d-88f5-b1a5d4e62b43</p>

<div>
<div>
<pre class="source">curl -X GET -H &quot;Content-type: application/json&quot;  http://localhost:8090/aggregated-objects/6acc3c87-75e0-4b6d-88f5-b1a5d4e62b43
</pre></div></div>
</div>
<div class="section">
<h2><a name="Perform_freestyle_query_on_created_aggregated_object"></a>Perform freestyle query on created aggregated object</h2>
<p>It is possible to make queries on aggregated objects using freestyle queries. These freestyle queries are plain Mongo DB queries, you can read more about that <a class="externalLink" href="https://docs.mongodb.com/manual/tutorial/query-documents/">here</a>.</p>

<div>
<div>
<pre class="source">POST /aggregated-objects/query
</pre></div></div>

<p><b>Body (application/json)</b>:</p>

<div>
<div>
<pre class="source">{
  &quot;criteria&quot;: &lt;MongoDB query&gt;
  &quot;options&quot;: &lt;MongoDB query&gt; // This one is optional
  &quot;filter&quot;: &lt;JMESPath expression&gt; // This one is optional
}
</pre></div></div>

<p>Examples of this endpoint using curl</p>

<div>
<div>
<pre class="source">curl -X POST -H &quot;Content-type: application/json&quot;  --data @Body.json http://localhost:34911/aggregated-objects/query
</pre></div></div>

<p>Examples of criterias:</p>

<div>
<div>
<pre class="source">// This returns all objects where the testCaseExecutions.outcome.id is&quot;TC5&quot;
// or testCaseExecutions.outcome.id is &quot;TC6&quot; and &quot;identity&quot;
// is &quot;pkg:maven/com.mycompany.myproduct/sub-system@1.1.0&quot;.

{
  &quot;criteria&quot;: {
    &quot;$or&quot;: [
      {
        &quot;testCaseExecutions.outcome.id&quot;:&quot;TC5&quot;
      }, {
        &quot;testCaseExecutions.outcome.id&quot;:&quot;TC6&quot;
      }
    ],
    &quot;identity&quot;:&quot;pkg:maven/com.mycompany.myproduct/sub-system@1.1.0&quot;
  }
}


// This returns all objects where TC5 succeeded in
// the array testCaseExecutions and identity is &quot;pkg:maven/com.mycompany.myproduct/sub-system@1.1.0&quot;.
// Options section is optional.

{
  &quot;criteria&quot;: {
    &quot;testCaseExecutions&quot;: {
      &quot;$elemMatch&quot;: {
        &quot;outcome.conclusion&quot;: &quot;SUCCESSFUL&quot;,
        &quot;outcome.id&quot;: &quot;TC5&quot;
      }
    }
  },
  &quot;options&quot;: {
    &quot;identity&quot;:&quot;pkg:maven/com.mycompany.myproduct/sub-system@1.1.0&quot;
  }
}


// This returns all objects where TC5 succeeded
// and are related to JIRA ticket JIRA-1234
{
    &quot;criteria&quot;: {
         &quot;testCaseExecutions&quot;: {
             &quot;$elemMatch&quot;: {
                 &quot;outcome.conclusion&quot;: &quot;SUCCESSFUL&quot;,
                 &quot;outcome.id&quot;: &quot;TC5&quot;
             }
         },
         &quot;$where&quot; : &quot;function() {
             var searchKey = 'id';
             var value = 'JIRA-1234';
             return searchInObj(obj);
             function searchInObj(obj){
                 for (var k in obj){
                     if (obj[k] == value &amp;&amp; k == searchKey) {
                         return true;
                     }

                     if (isObject(obj[k]) &amp;&amp; obj[k] !== null) {
                         if (searchInObj(obj[k])) {
                             return true;
                         }
                     }
                 }
                 return false;
             }
         }&quot;
    }
}
</pre></div></div>
</div>
<div class="section">
<h2><a name="Example_of_freestyle_query_that_returns_all_aggregated_objects"></a>Example of freestyle query that returns all aggregated objects</h2>
<p>By using a query that contains only empty &#x201c;criteria&#x201d; it is possible to return all aggregated objects from the database. The aggregated objects will be returned from specific collection (which name is defined by property aggregated.collection.name) that is stored in specific database (which name is defined by property spring.data.mongodb.database). Read more about the different properties in <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/src/main/resources/application.properties">application&#x2019;s properties</a> or in the <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/configuration.md">documentation</a>.</p>
<p>Example:</p>

<div>
<div>
<pre class="source">{
  &quot;criteria&quot;: {}
}
</pre></div></div>
</div>
<div class="section">
<h2><a name="Query_an_aggregated_object_and_filter_it_with_specific_key"></a>Query an aggregated object and filter it with specific key</h2>
<p>It is possible to filter the result from the query and return only the values which are of interest. This filter can be defined as a path in the aggregated object, or a specific key. The parameter of filter condition is a JMESPath expression, you can read more about that <a class="externalLink" href="http://jmespath.org/tutorial.html#pipe-expressions">here</a>.</p>
<p>Example:</p>

<div>
<div>
<pre class="source">// This match an object in the same way as in the previous example. And then filter
// it and returns eventId that has a path &quot;publications[0].eventId&quot;.

{
  &quot;criteria&quot;: {
    &quot;testCaseExecutions&quot;: {
      &quot;$elemMatch&quot;: {
        &quot;outcome.conclusion&quot;: &quot;SUCCESSFUL&quot;,
        &quot;outcome.id&quot;: &quot;TC5&quot;
      }
    }
  },
  &quot;options&quot;: {
    &quot;identity&quot;:&quot;pkg:maven/com.mycompany.myproduct/sub-system@1.1.0&quot;
  },
  &quot;filter&quot; : &quot;publications[0].eventId&quot;
}
</pre></div></div>

<p>To filter with only the key or the partial path, it is required to use &#x201c;incomplete_path_filter(@, &#x2018;some key&#x2019;)&#x201d;.</p>
<p>Example:</p>

<div>
<div>
<pre class="source">// This finds all objects where identity is &quot;pkg:maven/com.mycompany.myproduct/sub-system@1.1.0&quot;.
// Then it filters those objects and returns all values that has &quot;gitIdentifier&quot; as a key.

{
  &quot;criteria&quot;: {
     &quot;identity&quot;:&quot;pkg:maven/com.mycompany.myproduct/sub-system@1.1.0&quot;
  },
  &quot;filter&quot; : &quot;incomplete_path_filter(@, 'gitIdentifier')&quot;
}
</pre></div></div>

<p>As the filter functionality takes a plain jmespath expression it can be a more complex expression as well. In the case below we retrieve all aggregated objects that contains a certain commit using the criteria(MongoDB query) and then filter out which confidence levels the artifact has succeeded on. NOTE that the Mongo DB query as well as the jmespath expression needs to be on the same line as json cannot handle multilines inside a string. Although some tools such as curl will automatically minimize.</p>
<p>Example</p>

<div>
<div>
<pre class="source">{
    &quot;criteria&quot;: {
        &quot;$where&quot;: &quot;function(){ var searchKey = 'id'; var value = 'JIRA-1234'; return searchInObj(obj); function searchInObj(obj){ for (var k in obj){ if (obj[k] == value &amp;&amp; k == searchKey) { return true;  } if (isObject(obj[k]) &amp;&amp; obj[k] !== null) { if (searchInObj(obj[k])) { return true;}}} return false; }}&quot;
    },
    &quot;filter&quot;: &quot;{id: id, artifactIdentity: identity, confidenceLevels: confidenceLevels[?value=='SUCCESS'].{name: name, value: value}}&quot;
}
</pre></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                          
                </div>

        
                </div>
    </footer>
        </body>
</html>
