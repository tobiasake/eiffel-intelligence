<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 2019-12-02 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20191202" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Eiffel Intelligence &#x2013; Rules</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

          
                      </head>
        <body class="topBarEnabled">
          
                
                    
                

    <div id="topbar" class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
                <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
                
                                                                                                    <a class="brand" href="./" >

                                
                                    Eiffel Intelligence
                
                </a>
                    
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="index.html"  title="Home">Home</a>
</li>
                  
                      <li class="dropdown-submenu">
                                      <a href="running-eiffel-intelligence.html"  title="Running Eiffel Intelligence">Running Eiffel Intelligence</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="configuration.html"  title="Configuration">Configuration</a>
</li>
                                  <li>      <a href="docker.html"  title="Running in Docker">Running in Docker</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="subscriptions.html"  title="Understanding subscriptions">Understanding subscriptions</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="subscription-with-REST-POST-notification.html"  title="Subscription with REST POST notification">Subscription with REST POST notification</a>
</li>
                                  <li>      <a href="triggering-jenkins-jobs.html"  title="HTTP POST notification to trigger parameterized Jenkins jobs">HTTP POST notification to trigger parameterized Jenkins jobs</a>
</li>
                                  <li>      <a href="subscription-with-email-notification.html"  title="Subscription with Email notification">Subscription with Email notification</a>
</li>
                                  <li>      <a href="step-by-step-subscription-notification.html"  title="Step-by-step Subscription Notification">Step-by-step Subscription Notification</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="rules.html"  title="Understanding rules">Understanding rules</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="merge-resolver-rules.html"  title="Merge Resolver Rules">Merge Resolver Rules</a>
</li>
                                  <li>      <a href="history-rules.html"  title="History Rules">History Rules</a>
</li>
                                  <li>      <a href="example-rules.html"  title="Example Rules">Example Rules</a>
</li>
                                  <li>      <a href="mapping-rules-to-aggregations.html"  title="Mapping Rules To Aggregations">Mapping Rules To Aggregations</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="step-by-step-aggregation.html"  title="Step-by-step aggregation">Step-by-step aggregation</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="artifact-created-event-aggregation.html"  title="ArtifactCreatedEvent aggregation">ArtifactCreatedEvent aggregation</a>
</li>
                                  <li>      <a href="test-case-triggered-event-aggregation.html"  title="TestCaseTriggeredEvent aggregation">TestCaseTriggeredEvent aggregation</a>
</li>
                                  <li>      <a href="test-case-started-event-aggregation.html"  title="TestCaseStartedEvent aggregation">TestCaseStartedEvent aggregation</a>
</li>
                                  <li>      <a href="test-case-finished-event-aggregation.html"  title="TestCaseFinishedEvent aggregation">TestCaseFinishedEvent aggregation</a>
</li>
                                  <li>      <a href="artifact-published-event-aggregation.html"  title="ArtifactPublishedEvent aggregation">ArtifactPublishedEvent aggregation</a>
</li>
                                  <li>      <a href="confidence-level-modified-event-aggregation.html"  title="ConfidenceLevelModifiedEvent">ConfidenceLevelModifiedEvent</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="REST-API.html"  title="REST API">REST API</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="query.html"  title="Query">Query</a>
</li>
                                  <li>      <a href="failed-notifications.html"  title="Failed notifications">Failed notifications</a>
</li>
                                  <li>      <a href="running-rules-on-objects.html"  title="Running rules on objects">Running rules on objects</a>
</li>
                                  <li>      <a href="authentication.html"  title="Authentication">Authentication</a>
</li>
                                  <li>      <a href="subscription-API.html"  title="Subscriptions">Subscriptions</a>
</li>
                                  <li>      <a href="status.html"  title="Status">Status</a>
</li>
                                  <li>      <a href="templates.html"  title="Get templates">Get templates</a>
</li>
                              </ul>
            </li>
                  
                      <li>      <a href="compatibility.html"  title="Compatibility">Compatibility</a>
</li>
                  
                      <li>      <a href="known-limitations.html"  title="Known limitations">Known limitations</a>
</li>
                          </ul>
      </li>
                  </ul>
          
          
          
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Eiffel Intelligence</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                              <li class="">
                    <a href="index.html" title="Home">
        Home</a>
                    <span class="divider">-</span>
      </li>
        <li class="active ">Rules</li>
        
              
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2019-12-02</li>
              <li id="projectVersion" class="pull-right">
                    Version: 2.0.0
        </li>
            
                            </ul>
      </div>

                  
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                              
      <li>
  
                          <a href="index.html" title="Home">
          <span class="none"></span>
        Home</a>
            </li>
                                                                                    
      <li>
  
                          <a href="running-eiffel-intelligence.html" title="Running Eiffel Intelligence">
          <span class="icon-chevron-right"></span>
        Running Eiffel Intelligence</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="subscriptions.html" title="Understanding subscriptions">
          <span class="icon-chevron-right"></span>
        Understanding subscriptions</a>
                  </li>
                                                                                                                            
      <li class="active">
  
            <a href="#"><span class="icon-chevron-down"></span>Understanding rules</a>
                  <ul class="nav nav-list">
                    
      <li>
  
                          <a href="merge-resolver-rules.html" title="Merge Resolver Rules">
          <span class="none"></span>
        Merge Resolver Rules</a>
            </li>
                    
      <li>
  
                          <a href="history-rules.html" title="History Rules">
          <span class="none"></span>
        History Rules</a>
            </li>
                    
      <li>
  
                          <a href="example-rules.html" title="Example Rules">
          <span class="none"></span>
        Example Rules</a>
            </li>
                    
      <li>
  
                          <a href="mapping-rules-to-aggregations.html" title="Mapping Rules To Aggregations">
          <span class="none"></span>
        Mapping Rules To Aggregations</a>
            </li>
              </ul>
        </li>
                                                                                                                                                            
      <li>
  
                          <a href="step-by-step-aggregation.html" title="Step-by-step aggregation">
          <span class="icon-chevron-right"></span>
        Step-by-step aggregation</a>
                  </li>
                                                                                                                                                                              
      <li>
  
                          <a href="REST-API.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                
      <li>
  
                          <a href="compatibility.html" title="Compatibility">
          <span class="none"></span>
        Compatibility</a>
            </li>
                
      <li>
  
                          <a href="known-limitations.html" title="Known limitations">
          <span class="none"></span>
        Known limitations</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                        
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Rules</h1>
<div class="section">
<h2><a name="What_is_JMESPath.3F"></a>What is JMESPath?</h2>
<p>JMESPath is a query language for JSON. You can extract and transform elements from a JSON document. The result of applying a JMESPath expression against a JSON document will always result in valid JSON, provided there are no errors during the evaluation process. This also means that, with the exception of JMESPath expression types, JMESPath only supports the same types support by JSON:</p>

<div>
<div>
<pre class="source">number (integers and double-precision floating-point format in JSON)
string
boolean (true or false)
array (an ordered, sequence of values)
object (an unordered collection of key value pairs)
null
</pre></div></div>

<p>Let&#x2019;s go to an example of simple query called identifier. An identifier is the most basic expression and can be used to extract a single element from a JSON object. The return value for an identifier is the value associated with the identifier. If the identifier does not exist in the JSON document, than a null value is returned. Assume that we have such JSON object {&#x201c;a&#x201d;: {&#x201c;b&#x201d;: {&#x201c;c&#x201d;: {&#x201c;d&#x201d;: &#x201c;value&#x201d;}}}} and we need to get the string &#x201c;value&#x201d; from object. The JMESPath identifier will be a.b.c.d. <a class="externalLink" href="http://jmespath.org/specification.html#identifiers">JMESPath identifier documentation</a>.</p>
<div class="section">
<h3><a name="Extract_data_from_Eiffel_event"></a>Extract data from Eiffel event</h3>

<div>
<div>
<pre class="source">    {
        &quot;meta&quot;: {
            &quot;id&quot;: &quot;e3be0cf8-2ebd-4d6d-bf5c-a3b535cd084e&quot;,
            &quot;type&quot;: &quot;EiffelConfidenceLevelModifiedEvent&quot;,
            &quot;version&quot;: &quot;1.1.0&quot;,
            &quot;time&quot;: 1521452400324,
            &quot;tags&quot;: [],
            &quot;source&quot;: {
                &quot;serializer&quot;: &quot;pkg:maven/com.mycompany.tools/eiffel-serializer@1.0.3&quot;,
                &quot;uri&quot;: &quot;http://host:port/path&quot;
            }
        },
        &quot;data&quot;: {
            &quot;name&quot;: &quot;dummy_1_stable&quot;,
            &quot;value&quot;: &quot;SUCCESS&quot;
        },
        &quot;links&quot;: [
            {
                &quot;type&quot;: &quot;SUBJECT&quot;,
                &quot;target&quot;: &quot;df4cdb42-1580-4cff-b97a-4d0faa9b2b22&quot;
            }
        ]
    }
</pre></div></div>

<p>Lets go through an example, in which we need to extract the value &#x201c;SUCCESS&#x201d; from an Eiffel event. The expression for such a JSON query will be &#x201c;data.value&#x201d;.</p>
<p>Eiffel Intelligence uses JMESPath for extracting information from events and for post processing of data in an aggregated object. Hence, JMESPath is used to traverse JSON structures when writing rules, subscription requirements or querying an aggregated object.</p></div></div>
<div class="section">
<h2><a name="Rule_set_up"></a>Rule set up</h2>
<p>Rules for object aggregation consist of JSON object with a defined structure inside it. Key in this object is rule specification and value is JMESPath identifier. Separate rule set is created for each event type that is going to take participation in creating of aggregated object. This means that if you want to create your aggregated object from 3 event types and all other event types to discard, you will need 3 set of rules. Each rule might contain some of these keys, that have not null or empty values. Explicit list of rule keys are below:</p>
<div class="section">
<h3><a name="TemplateName"></a>TemplateName</h3>
<p>used for specifying a template group, any string you like to name your template</p></div>
<div class="section">
<h3><a name="Type"></a>Type</h3>
<p>Eiffel event type, which will be used to find the matching rule set for the received Eiffel event while creating aggregated object. Example: &#x201c;EiffelConfidenceLevelModifiedEvent&#x201d;</p></div>
<div class="section">
<h3><a name="TypeRule"></a>TypeRule</h3>
<p>JMESPath identifier for the location of Eiffel event type in received Eiffel event. Example: &#x201c;meta.type&#x201d;.</p></div>
<div class="section">
<h3><a name="IdRule"></a>IdRule</h3>
<p>JMESPath identifier for the location of Eiffel event id in received Eiffel event. Example: &#x201c;meta.id&#x201d;. Used as fall back when storing in database and no id is provided or to link id of aggregated objects to events that contributed to the aggregated object.</p></div>
<div class="section">
<h3><a name="StartEvent"></a>StartEvent</h3>
<p>denotes if this event type starts the object aggregation. If StartEvent is &#x201c;YES&#x201d; then it will be the first processed event in the aggregation sequence. If StartEvent is &#x201c;NO&#x201d; then Eiffel event of this type will be used to append information to existing aggregated object. If no aggregated object exist then it will wait a certain time as defined by property <i>waitlist.collection.ttlValue</i> in <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/src/main/resources/application.properties">application&#x2019;s properties</a> until wanted aggregated object has been created. If no aggregated object is created in time then the event will no longer be processed and it will be removed from the wait list.</p></div>
<div class="section">
<h3><a name="IdentifyRules"></a>IdentifyRules</h3>
<p>JMESPath identifier of ids that will be used to search for an existing aggregated object. Should produce an JSON array, for example &#x201c;[meta.id]&#x201d;</p>
<p>which will return the specified field in array</p>

<div>
<div>
<pre class="source">[&quot;sb6e51h0-25ch-4dh7-b9sd-876g8e6kde47&quot;].
</pre></div></div>

<p>Another common example is</p>

<div>
<div>
<pre class="source">&quot;links | [?type=='CAUSE'].target&quot;
</pre></div></div>

<p>which will extract the event id from links array value of target, where &#x201c;type&#x201d; is equal &#x201c;CAUSE&#x201d;. Links in an Eiffel event look like</p>

<div>
<div>
<pre class="source">{
   &quot;links&quot;:[
      {
         &quot;target&quot;:&quot;f37d59a3-069e-4f4c-8cc5-a52e73501a75&quot;,
         &quot;type&quot;:&quot;CAUSE&quot;
      },
     {
         &quot;target&quot;:&quot;cfce572b-c3j4-441e-abc9-b62f48080ca2&quot;,
         &quot;type&quot;:&quot;ELEMENT&quot;
     }
  ]
}
</pre></div></div>

<p>and applying the above links extraction rule will give [&#x201c;f37d59a3-069e-4f4c-8cc5-a52e73501a75&#x201d;]</p>
<p>If ids of all links is needed then</p>

<div>
<div>
<pre class="source">links | [].target
</pre></div></div>

<p>will return</p>

<div>
<div>
<pre class="source">[
 &quot;f37d59a3-069e-4f4c-8cc5-a52e73501a75&quot;,
 &quot;cfce572b-c3j4-441e-abc9-b62f48080ca2&quot;
]
</pre></div></div>
</div>
<div class="section">
<h3><a name="MatchIdRules"></a>MatchIdRules</h3>
<p>This rule is used to search in database containing the aggregated objects. The syntax of this rule is specific to querying in Mongo DB. Use marker &#x201c;%IdentifyRules_objid%&#x201d; to inject the ids generated by <b><i>IdentifyRules</i></b>. Examples:</p>

<div>
<div>
<pre class="source">{&quot;_id&quot;: &quot;%IdentifyRules_objid%&quot;},
{ &quot;$and&quot;: [{&quot;testCaseExecutions.testCaseStartedEventId&quot;: &quot;%IdentifyRules%&quot;}]}
</pre></div></div>
</div>
<div class="section">
<h3><a name="ExtractionRules"></a>ExtractionRules</h3>
<p>JSON object of JMESPath identifier(s) which will create or modify the existing data in aggregated object. For a start event the content extracted with this rule will be the initial aggregated object.</p>
<p>For example</p>

<div>
<div>
<pre class="source">&quot;{confidenceLevels :[{ eventId:meta.id, time:meta.time, name:data.name, value:data.value}]}&quot;
</pre></div></div>

<p>will create JSON object &#x201c;confidenceLevels&#x201d; and the value of it will be array with 1 JSON element. This one key in this JSON object will be &#x201c;eventId&#x201d; and its value will be the result of searching for &#x201c;meta.id&#x201d; identifier in the received Eiffel event, for example &#x201c;cfce572b-c3j4-441e-abc9-b62f48080ca2&#x201d; and so on.</p>
<p>Evaluation of specified extraction rules on the received Eiffel event may be the JSON object</p>

<div>
<div>
<pre class="source">{
  &quot;confidenceLevels&quot;:[
    {
     &quot;eventId&quot;:&quot;f37d59a3-069e-4f4c-8cc5-a52e73501a75&quot;,
     &quot;name&quot;:&quot;readyForDelivery&quot;,
     &quot;time&quot;:1481875944272,
     &quot;value&quot;:&quot;SUCCESS&quot;
    }
 ]
}
</pre></div></div>

<p>which could be added to the root of aggregated object or to the inner structure of aggregated object depending on <b><i>MergeResolverRules</i></b>.</p></div>
<div class="section">
<h3><a name="MergeResolverRules"></a>MergeResolverRules</h3>
<p>This is a JSON object describing the entire path or parts of the path to where the extracted content will be stored. More detailed explanation can be found <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/merge-resolver-rules.md">here</a></p></div>
<div class="section">
<h3><a name="ProcessRules"></a>ProcessRules</h3>
<p>This rule is used to append (<i>only additions or modifications, no deletions, of existing content at time rule is applied</i>) new key value pairs in the aggregated object based on existing values in the aggregation object. For example if you have aggregated the job finished time and job started time then you can create one more value for the computed duration so that other systems do not need to compute it.</p></div>
<div class="section">
<h3><a name="History_Rules"></a>History Rules</h3>
<p>are used if you need to aggregate data from existing events linked upstream by received event. They are explained <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/history-rules.md"><b>here</b></a></p></div></div>
<div class="section">
<h2><a name="Reserved_Key_names"></a>Reserved Key names</h2>
<p>The keys &#x201c;_id&#x201d; and &#x201c;time&#x201d; (at the root level of the aggregated object) are reserved and added in the mongo document by Eiffel Intelligence. User should not use these two keys at the root level of an aggregated object. Even If user add these two keys at the root level, Eiffel Intelligence will overwrite those.</p></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                          
                </div>

        
                </div>
    </footer>
        </body>
</html>
